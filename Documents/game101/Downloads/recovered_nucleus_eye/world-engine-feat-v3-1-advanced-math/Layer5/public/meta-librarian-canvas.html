<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå± Meta-Librarian Recursive Pipeline Canvas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            overflow: hidden;
        }

        .pipeline-canvas {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
            background: radial-gradient(circle at center, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

        .pipeline-zone {
            position: absolute;
            border-radius: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.1);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .pipeline-zone:hover {
            transform: scale(1.05);
            border-color: rgba(255,255,255,0.8);
            background: rgba(255,255,255,0.2);
        }

        .zone-head {
            width: 200px;
            height: 120px;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border-color: #4CAF50;
        }

        .zone-root {
            width: 180px;
            height: 100px;
            top: 200px;
            left: 100px;
            background: linear-gradient(45deg, #FF6B6B, #ee5a5a);
            border-color: #FF6B6B;
        }

        .zone-context {
            width: 180px;
            height: 100px;
            top: 200px;
            left: 320px;
            background: linear-gradient(45deg, #4ECDC4, #44b3aa);
            border-color: #4ECDC4;
        }

        .zone-axiom {
            width: 180px;
            height: 100px;
            top: 200px;
            left: 540px;
            background: linear-gradient(45deg, #45B7D1, #3a9bc1);
            border-color: #45B7D1;
        }

        .zone-relationship {
            width: 180px;
            height: 100px;
            top: 350px;
            left: 100px;
            background: linear-gradient(45deg, #96CEB4, #85c1a3);
            border-color: #96CEB4;
        }

        .zone-pattern {
            width: 180px;
            height: 100px;
            top: 350px;
            left: 320px;
            background: linear-gradient(45deg, #FFEAA7, #fdcb6e);
            border-color: #FFEAA7;
        }

        .zone-synthetic {
            width: 180px;
            height: 100px;
            top: 350px;
            left: 540px;
            background: linear-gradient(45deg, #DDA0DD, #d98ed9);
            border-color: #DDA0DD;
        }

        .zone-output {
            width: 200px;
            height: 120px;
            top: 500px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #FF7675, #e84b4a);
            border-color: #FF7675;
        }

        .zone-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .zone-emoji {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .zone-description {
            font-size: 11px;
            opacity: 0.9;
            line-height: 1.2;
        }

        .pipeline-flow {
            position: absolute;
            pointer-events: none;
            z-index: 0;
        }

        .flow-arrow {
            position: absolute;
            background: rgba(255,255,255,0.6);
            height: 3px;
            border-radius: 2px;
            opacity: 0;
            animation: flowPulse 3s ease-in-out infinite;
        }

        @keyframes flowPulse {
            0%, 100% { opacity: 0; transform: scaleX(0); }
            50% { opacity: 1; transform: scaleX(1); }
        }

        .recursive-loop {
            position: absolute;
            right: 50px;
            top: 50%;
            transform: translateY(-50%);
            width: 100px;
            height: 300px;
            border: 3px dashed rgba(255,255,255,0.4);
            border-radius: 50px;
            animation: recursivePulse 4s ease-in-out infinite;
        }

        @keyframes recursivePulse {
            0%, 100% { border-color: rgba(255,255,255,0.4); }
            50% { border-color: rgba(255,255,255,0.8); }
        }

        .camera-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .camera-btn {
            padding: 10px 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .camera-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .growth-metrics {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
        }

        .branch-indicator {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .branch-active {
            opacity: 1;
            animation: branchPulse 2s ease-in-out infinite;
        }

        @keyframes branchPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .pipeline-state {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            min-width: 200px;
        }

        .state-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .state-active { background: #4CAF50; }
        .state-processing { background: #FFC107; animation: blink 1s infinite; }
        .state-complete { background: #2196F3; }

        @keyframes blink {
            50% { opacity: 0.3; }
        }

        .turtle-shell {
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(139, 69, 19, 0.7);
            border-radius: 50%;
            border: 2px solid #8B4513;
            opacity: 0;
            animation: turtleMove 6s ease-in-out infinite;
        }

        @keyframes turtleMove {
            0%, 100% { opacity: 0; transform: translateY(20px); }
            25%, 75% { opacity: 1; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-10px); }
        }

        .feedback-arrow {
            position: absolute;
            right: 100px;
            top: 200px;
            width: 80px;
            height: 200px;
            border-left: 3px solid rgba(255,255,255,0.5);
            border-bottom: 3px solid rgba(255,255,255,0.5);
            border-radius: 0 0 0 20px;
            transform: rotate(45deg);
            opacity: 0;
            animation: feedbackFlow 8s ease-in-out infinite 2s;
        }

        @keyframes feedbackFlow {
            0%, 90%, 100% { opacity: 0; }
            10%, 80% { opacity: 1; }
        }

        /* Toast notification system */
        #toast {
            position: absolute;
            left: 50%;
            top: 10px;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 12px 20px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.25s ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <div class="pipeline-canvas" id="canvas">
        <!-- Toast notification element -->
        <div id="toast" role="alert" aria-live="polite"></div>

        <!-- Pipeline State Indicator -->
        <div class="pipeline-state">
            <h3>üå± Pipeline Status</h3>
            <div><span class="state-indicator state-active"></span>Ready for Input</div>
            <div><span class="state-indicator state-processing"></span>Processing: <span id="currentZone">HEAD</span></div>
            <div><span class="state-indicator state-complete"></span>Cycles: <span id="cycleCount">0</span></div>
        </div>

        <!-- Camera Controls -->
        <div class="camera-controls">
            <button class="camera-btn" onclick="try { zoomIn(); } catch(e) { console.error(\'Button error:\', e); }">üîç Zoom In</button>
            <button class="camera-btn" onclick="try { zoomOut(); } catch(e) { console.error(\'Button error:\', e); }">üîç Zoom Out</button>
            <button class="camera-btn" onclick="try { panToBranch(); } catch(e) { console.error(\'Button error:\', e); }">üìã Pan Branch</button>
        </div>

        <!-- HEAD Zone -->
        <div class="pipeline-zone zone-head"
             onclick="activateZone('HEAD')"
             onkeydown="if(event.key === 'Enter' || event.key === ' ') activateZone('HEAD')"
             role="button"
             tabindex="0"
             aria-label="HEAD zone - Input Zone for incoming data, code, or concepts">
            <div class="zone-emoji">üì•</div>
            <div class="zone-title">HEAD</div>
            <div class="zone-description">Input Zone<br/>Incoming data/code/concept</div>
        </div>

        <!-- ROOT EXTRACTION Zone -->
        <div class="pipeline-zone zone-root"
             onclick="activateZone('ROOT_EXTRACTION')"
             onkeydown="if(event.key === 'Enter' || event.key === ' ') activateZone('ROOT_EXTRACTION')"
             role="button"
             tabindex="0"
             aria-label="ROOT EXTRACTION zone - Extract root concepts and structures">
            <div class="zone-emoji">üê¢</div>
            <div class="zone-title">ROOT EXTRACTION</div>
            <div class="zone-description">Find the irreducible core<br/>Turtle into essence</div>
            <div class="turtle-shell" style="top: -20px; left: 20px;"></div>
        </div>

        <!-- CONTEXT STRIPPING Zone -->
        <div class="pipeline-zone zone-context" onclick="activateZone('CONTEXT_STRIPPING')">
            <div class="zone-emoji">üê¢</div>
            <div class="zone-title">CONTEXT STRIPPING</div>
            <div class="zone-description">Remove surface noise<br/>Abstract patterns</div>
            <div class="turtle-shell" style="top: -20px; left: 40px;"></div>
        </div>

        <!-- AXIOMATIC MAPPING Zone -->
        <div class="pipeline-zone zone-axiom" onclick="activateZone('AXIOMATIC_MAPPING')">
            <div class="zone-emoji">üê¢</div>
            <div class="zone-title">AXIOMATIC MAPPING</div>
            <div class="zone-description">Test assumptions<br/>Pressure-test axioms</div>
            <div class="turtle-shell" style="top: -20px; left: 60px;"></div>
        </div>

        <!-- RELATIONSHIP WEAVING Zone -->
        <div class="pipeline-zone zone-relationship" onclick="activateZone('RELATIONSHIP_WEAVING')">
            <div class="zone-emoji">üê¢</div>
            <div class="zone-title">RELATIONSHIP WEAVING</div>
            <div class="zone-description">Build connectome<br/>Weave analogies</div>
            <div class="turtle-shell" style="top: -20px; left: 80px;"></div>
        </div>

        <!-- PATTERN RECOGNITION Zone -->
        <div class="pipeline-zone zone-pattern" onclick="activateZone('PATTERN_RECOGNITION')">
            <div class="zone-emoji">üê¢</div>
            <div class="zone-title">PATTERN RECOGNITION</div>
            <div class="zone-description">Find motifs & rhythms<br/>Detect outliers</div>
            <div class="turtle-shell" style="top: -20px; left: 100px;"></div>
        </div>

        <!-- SYNTHETIC REBUILD Zone -->
        <div class="pipeline-zone zone-synthetic" onclick="activateZone('SYNTHETIC_REBUILD')">
            <div class="zone-emoji">üê¢</div>
            <div class="zone-title">SYNTHETIC REBUILD</div>
            <div class="zone-description">Grow new structures<br/>Generate frameworks</div>
            <div class="turtle-shell" style="top: -20px; left: 120px;"></div>
        </div>

        <!-- ACTIONABLE OUTPUT Zone -->
        <div class="pipeline-zone zone-output" onclick="activateZone('ACTIONABLE_OUTPUT')">
            <div class="zone-emoji">üöÄ</div>
            <div class="zone-title">ACTIONABLE OUTPUT</div>
            <div class="zone-description">Render decisions & models<br/>Ready for action</div>
        </div>

        <!-- Recursive Feedback Loop -->
        <div class="recursive-loop"></div>
        <div class="feedback-arrow"></div>

        <!-- Branch Indicators -->
        <div class="branch-indicator" id="branch1" style="top: 250px; left: 250px;">üåø</div>
        <div class="branch-indicator" id="branch2" style="top: 400px; left: 450px;">üåø</div>
        <div class="branch-indicator" id="branch3" style="top: 300px; left: 650px;">üåø</div>

        <!-- Growth Metrics -->
        <div class="growth-metrics">
            <h4>üå± Agriculture Metrics</h4>
            <div>Processes: <span id="totalProcesses">0</span></div>
            <div>Feedback Cycles: <span id="feedbackCycles">0</span></div>
            <div>Active Branches: <span id="activeBranches">0</span></div>
            <div>Growth Rate: <span id="growthRate">1.0x</span></div>
            <div>Harvest Ready: <span id="harvestReady">0</span></div>
        </div>
    </div>

    <script>
        class PipelineCanvas {
            constructor() {
                this.zoomLevel = 1.0;
                this.currentZone = 'HEAD';
                this.processingQueue = [];
                this.branches = [];
                this.cycleCount = 0;
                this.totalProcesses = 0;
                this.feedbackCycles = 0;

                this.initializeCanvas();
                this.startAnimation();
            }

            initializeCanvas() {
                // Initialize zone states
                this.zones = [
                    'HEAD', 'ROOT_EXTRACTION', 'CONTEXT_STRIPPING',
                    'AXIOMATIC_MAPPING', 'RELATIONSHIP_WEAVING',
                    'PATTERN_RECOGNITION', 'SYNTHETIC_REBUILD', 'ACTIONABLE_OUTPUT'
                ];

                // Create flow connections
                this.createFlowArrows();
            }

            createFlowArrows() {
                const canvas = document.getElementById('canvas');

                // Create flow arrows between zones
                const flows = [
                    { from: 'HEAD', to: 'ROOT_EXTRACTION' },
                    { from: 'ROOT_EXTRACTION', to: 'CONTEXT_STRIPPING' },
                    { from: 'CONTEXT_STRIPPING', to: 'AXIOMATIC_MAPPING' },
                    { from: 'AXIOMATIC_MAPPING', to: 'RELATIONSHIP_WEAVING' },
                    { from: 'RELATIONSHIP_WEAVING', to: 'PATTERN_RECOGNITION' },
                    { from: 'PATTERN_RECOGNITION', to: 'SYNTHETIC_REBUILD' },
                    { from: 'SYNTHETIC_REBUILD', to: 'ACTIONABLE_OUTPUT' }
                ];

                flows.forEach((flow, index) => {
                    const arrow = document.createElement('div');
                    arrow.className = 'flow-arrow';
                    arrow.style.animationDelay = `${index * 0.3}s`;
                    canvas.appendChild(arrow);
                });
            }

            startAnimation() {
                setInterval(() => {
                    this.updateMetrics();
                    this.animateTurtles();
                    this.checkForBranching();
                }, 2000);

                // Start processing simulation
                this.simulateProcessing();
            }

            simulateProcessing() {
                let currentZoneIndex = 0;

                const processNextZone = () => {
                    if (currentZoneIndex < this.zones.length) {
                        this.currentZone = this.zones[currentZoneIndex];
                        document.getElementById('currentZone').textContent = this.currentZone;

                        // Highlight current zone
                        this.highlightZone(this.currentZone);

                        currentZoneIndex++;
                        setTimeout(processNextZone, 1500);
                    } else {
                        // Complete cycle
                        this.completeCycle();
                        currentZoneIndex = 0;
                        setTimeout(processNextZone, 3000);
                    }
                };

                setTimeout(processNextZone, 1000);
            }

            highlightZone(zoneName) {
                // Remove previous highlights
                document.querySelectorAll('.pipeline-zone').forEach(zone => {
                    zone.style.borderColor = 'rgba(255,255,255,0.3)';
                    zone.style.boxShadow = '0 8px 32px rgba(0,0,0,0.2)';
                });

                // Highlight current zone
                const zoneClass = this.getZoneClass(zoneName);
                const zoneElement = document.querySelector(zoneClass);
                if (zoneElement) {
                    zoneElement.style.borderColor = 'rgba(255,255,0,0.8)';
                    zoneElement.style.boxShadow = '0 8px 32px rgba(255,255,0,0.3)';
                }
            }

            getZoneClass(zoneName) {
                const classMap = {
                    'HEAD': '.zone-head',
                    'ROOT_EXTRACTION': '.zone-root',
                    'CONTEXT_STRIPPING': '.zone-context',
                    'AXIOMATIC_MAPPING': '.zone-axiom',
                    'RELATIONSHIP_WEAVING': '.zone-relationship',
                    'PATTERN_RECOGNITION': '.zone-pattern',
                    'SYNTHETIC_REBUILD': '.zone-synthetic',
                    'ACTIONABLE_OUTPUT': '.zone-output'
                };
                return classMap[zoneName] || '.zone-head';
            }

            completeCycle() {
                this.cycleCount++;
                this.totalProcesses++;
                document.getElementById('cycleCount').textContent = this.cycleCount;

                // Trigger recursive feedback occasionally
                if (this.cycleCount % 3 === 0) {
                    this.feedbackCycles++;
                    this.triggerRecursiveFeedback();
                }
            }

            triggerRecursiveFeedback() {
                const feedbackArrow = document.querySelector('.feedback-arrow');
                feedbackArrow.style.animation = 'none';
                setTimeout(() => {
                    feedbackArrow.style.animation = 'feedbackFlow 3s ease-in-out';
                }, 100);
            }

            updateMetrics() {
                document.getElementById('totalProcesses').textContent = this.totalProcesses;
                document.getElementById('feedbackCycles').textContent = this.feedbackCycles;
                document.getElementById('activeBranches').textContent = this.branches.length;
                document.getElementById('growthRate').textContent = `${(1 + this.feedbackCycles * 0.1).toFixed(1)}x`;
                document.getElementById('harvestReady').textContent = Math.floor(this.totalProcesses / 5);
            }

            animateTurtles() {
                const turtles = document.querySelectorAll('.turtle-shell');
                turtles.forEach((turtle, index) => {
                    turtle.style.animationDelay = `${index * 0.5}s`;
                });
            }

            checkForBranching() {
                // Randomly activate branches for demonstration
                if (Math.random() < 0.3) {
                    const branchIndex = Math.floor(Math.random() * 3) + 1;
                    const branch = document.getElementById(`branch${branchIndex}`);
                    branch.classList.add('branch-active');

                    setTimeout(() => {
                        branch.classList.remove('branch-active');
                    }, 3000);

                    this.branches.push(`branch_${Date.now()}`);
                    setTimeout(() => {
                        this.branches.shift();
                    }, 10000);
                }
            }

            zoomIn() {
                this.zoomLevel *= 1.2;
                const canvas = document.getElementById('canvas');
                canvas.style.transform = `scale(${this.zoomLevel})`;
                canvas.style.transformOrigin = 'center center';
            }

            zoomOut() {
                this.zoomLevel /= 1.2;
                const canvas = document.getElementById('canvas');
                canvas.style.transform = `scale(${this.zoomLevel})`;
                canvas.style.transformOrigin = 'center center';
            }

            panToBranch() {
                // Pan to active branch
                const activeBranch = document.querySelector('.branch-active');
                if (activeBranch) {
                    const rect = activeBranch.getBoundingClientRect();
                    const canvas = document.getElementById('canvas');
                    canvas.style.transformOrigin = `${rect.left + rect.width/2}px ${rect.top + rect.height/2}px`;
                    this.zoomLevel = 1.5;
                    canvas.style.transform = `scale(${this.zoomLevel})`;
                }
            }
        }

        // Global functions for buttons
        let pipelineCanvas;

        function activateZone(zoneName) {
            console.log(`Activating zone: ${zoneName}`);
            pipelineCanvas.highlightZone(zoneName);

            // Show zone details in console or alert
            const zoneDescriptions = {
                'HEAD': 'Input Zone: Where new data, code, or concepts enter the pipeline',
                'ROOT_EXTRACTION': 'üê¢ Find the irreducible core - strip away everything non-essential',
                'CONTEXT_STRIPPING': 'üê¢ Remove context, surface details, and historical noise',
                'AXIOMATIC_MAPPING': 'üê¢ Identify and pressure-test fundamental assumptions',
                'RELATIONSHIP_WEAVING': 'üê¢ Build connection networks and weave analogies',
                'PATTERN_RECOGNITION': 'üê¢ Scan for motifs, rhythms, and detect outliers',
                'SYNTHETIC_REBUILD': 'üê¢ Grow new structures and generate frameworks',
                'ACTIONABLE_OUTPUT': 'üöÄ Render decisions, code, translations, or actionable models'
            };

            toast(`${zoneName}: ${zoneDescriptions[zoneName]}`);
        }

        // Toast notification function
        function toast(message) {
            const toastElement = document.getElementById('toast');
            toastElement.textContent = message;
            toastElement.style.opacity = '1';
            setTimeout(() => {
                toastElement.style.opacity = '0';
            }, 2500);
        }

        function zoomIn() {
            pipelineCanvas.zoomIn();
        }

        function zoomOut() {
            pipelineCanvas.zoomOut();
        }

        function panToBranch() {
            pipelineCanvas.panToBranch();
        }

        // Initialize the canvas
        document.addEventListener('DOMContentLoaded', () => {
            pipelineCanvas = new PipelineCanvas();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case 'z':
                    if (e.ctrlKey) zoomIn();
                    break;
                case 'x':
                    if (e.ctrlKey) zoomOut();
                    break;
                case 'b':
                    panToBranch();
                    break;
                case 'r':
                    location.reload();
                    break;
            }
        });
    </script>
</body>
</html>
