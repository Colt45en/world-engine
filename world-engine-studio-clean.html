<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>World Engine Studio ‚Äî Clean Working Interface</title>
<style>
  :root {
    --bg: #0b0e14; --panel: #0f1523; --ink: #e6f0ff; --mut: #9ab0d6;
    --line: #1e2b46; --acc: #54f0b8; --chip: #182741; --warn: #ffd166;
    --bad: #ff6b6b; --success: #00ff88; --beat: #ff4488; --holy: #ffaa00;
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; margin: 0; }

  body {
    background: var(--bg);
    color: var(--ink);
    font: 14px/1.4 system-ui, sans-serif;
    overflow: hidden;
  }

  /* RESPONSIVE GRID LAYOUT */
  .studio {
    display: grid;
    grid-template-columns: minmax(280px, 320px) 1fr minmax(280px, 320px);
    grid-template-rows: auto 1fr auto;
    gap: 8px;
    height: 100vh;
    padding: 8px;
    min-width: 900px;
  }

  @media (max-width: 1200px) {
    .studio {
      grid-template-columns: 260px 1fr 260px;
    }
  }

  @media (max-width: 900px) {
    .studio {
      grid-template-columns: 1fr;
      grid-template-rows: auto auto 1fr;
      min-width: 100%;
    }
    .left-panel, .right-panel { display: none; }
  }

  /* HEADER */
  .header {
    grid-column: 1 / -1;
    background: linear-gradient(90deg, #0d1322, #1a0f22, #0d1322);
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    min-height: 60px;
  }

  .logo {
    font-weight: 800;
    color: var(--acc);
    font-size: 18px;
  }

  .tagline {
    color: var(--mut);
    font-size: 13px;
  }

  .header-spacer { flex: 1; }

  .status-bar {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .status-chip {
    background: var(--chip);
    border: 1px solid var(--line);
    color: var(--ink);
    padding: 6px 12px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: 500;
  }

  .status-chip.online { background: var(--success); color: #000; }
  .status-chip.warning { background: var(--warn); color: #000; }
  .status-chip.error { background: var(--bad); color: #fff; }

  /* PANELS */
  .panel {
    background: linear-gradient(180deg, #0f1523, #0b1020);
    border: 1px solid var(--line);
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .panel-header {
    padding: 16px 20px 12px;
    border-bottom: 1px solid var(--line);
    font-weight: 700;
    color: #bfeaff;
    background: rgba(255,255,255,0.02);
    flex-shrink: 0;
  }

  .panel-content {
    flex: 1;
    padding: 16px 20px;
    overflow: auto;
    min-height: 0;
  }

  /* MAIN WORKSPACE */
  .workspace {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .workspace-toolbar {
    display: flex;
    gap: 8px;
    padding: 12px 16px;
    background: rgba(255,255,255,0.02);
    border-radius: 8px;
    flex-wrap: wrap;
  }

  .workspace-area {
    flex: 1;
    background: #06101c;
    border: 1px solid var(--line);
    border-radius: 8px;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 300px;
    overflow: auto;
  }

  .workspace-placeholder {
    text-align: center;
    color: var(--mut);
    line-height: 1.6;
  }

  .workspace-placeholder h3 {
    color: var(--acc);
    margin: 0 0 12px 0;
    font-size: 18px;
  }

  /* BUTTONS */
  .btn {
    background: var(--panel);
    border: 1px solid var(--line);
    color: var(--ink);
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .btn:hover {
    background: var(--chip);
    border-color: var(--acc);
    transform: translateY(-1px);
  }

  .btn:active {
    transform: translateY(0);
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .btn.primary { background: var(--acc); color: #000; font-weight: 600; }
  .btn.success { background: var(--success); color: #000; font-weight: 600; }
  .btn.warning { background: var(--warn); color: #000; font-weight: 600; }
  .btn.danger { background: var(--bad); color: #fff; font-weight: 600; }

  /* INPUTS */
  .input {
    width: 100%;
    background: #0b1120;
    border: 1px solid var(--line);
    color: var(--ink);
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 13px;
    transition: all 0.2s ease;
  }

  .input:focus {
    outline: none;
    border-color: var(--acc);
    box-shadow: 0 0 0 2px rgba(84, 240, 184, 0.1);
  }

  .input-group {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
  }

  .input-group .input {
    flex: 1;
  }

  /* CHAT INTERFACE */
  .chat {
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 250px;
  }

  .chat-messages {
    flex: 1;
    overflow: auto;
    background: #0a0f1c;
    border: 1px solid var(--line);
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 12px;
    min-height: 200px;
  }

  .chat-message {
    margin: 8px 0;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 13px;
    line-height: 1.4;
    animation: slideIn 0.2s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .chat-message.system {
    background: rgba(158, 234, 211, 0.1);
    color: #9eead3;
    border-left: 3px solid #9eead3;
  }

  .chat-message.user {
    background: rgba(84, 240, 184, 0.1);
    color: var(--acc);
    border-left: 3px solid var(--acc);
  }

  .chat-message.ai {
    background: rgba(255, 255, 255, 0.05);
    color: var(--ink);
    border-left: 3px solid var(--mut);
  }

  .chat-message.error {
    background: rgba(255, 107, 107, 0.1);
    color: var(--bad);
    border-left: 3px solid var(--bad);
  }

  .chat-message.success {
    background: rgba(0, 255, 136, 0.1);
    color: var(--success);
    border-left: 3px solid var(--success);
  }

  /* SYSTEM STATUS */
  .system-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 16px;
  }

  .system-status {
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    font-size: 12px;
    transition: all 0.2s ease;
  }

  .system-status.online {
    background: rgba(0, 255, 136, 0.15);
    color: var(--success);
    border: 1px solid rgba(0, 255, 136, 0.3);
  }

  .system-status.offline {
    background: rgba(255, 107, 107, 0.15);
    color: var(--bad);
    border: 1px solid rgba(255, 107, 107, 0.3);
  }

  .system-status.loading {
    background: rgba(255, 209, 102, 0.15);
    color: var(--warn);
    border: 1px solid rgba(255, 209, 102, 0.3);
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
  }

  .system-name {
    font-weight: 600;
    margin-bottom: 4px;
  }

  .system-info {
    opacity: 0.8;
    font-size: 11px;
  }

  /* FOOTER */
  .footer {
    grid-column: 1 / -1;
    text-align: center;
    padding: 12px;
    color: #6eaeb0;
    font-size: 12px;
    border-top: 1px solid var(--line);
  }

  /* GLYPH SYSTEM */
  .glyph-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
    gap: 8px;
    margin-bottom: 16px;
    padding: 16px;
    background: rgba(255,255,255,0.02);
    border-radius: 12px;
    border: 1px solid var(--line);
  }

  .glyph-action {
    width: 50px;
    height: 50px;
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .glyph-action:hover {
    transform: translateY(-2px) scale(1.05);
    border-color: var(--acc);
    box-shadow: 0 8px 25px rgba(84, 240, 184, 0.3);
    background: linear-gradient(135deg, var(--panel), var(--chip));
  }

  .glyph-action:active {
    transform: translateY(0) scale(0.95);
    box-shadow: 0 4px 15px rgba(84, 240, 184, 0.2);
  }

  .glyph-action.active {
    background: var(--acc);
    color: #000;
    border-color: var(--success);
    animation: glyphPulse 0.5s ease;
  }

  @keyframes glyphPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }

  .glyph-btn {
    position: relative;
    overflow: hidden;
  }

  .glyph-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    transition: all 0.3s ease;
    transform: translate(-50%, -50%);
  }

  .glyph-btn:hover::before {
    width: 100px;
    height: 100px;
  }

  .glyph-effect {
    position: fixed;
    pointer-events: none;
    z-index: 9999;
    font-size: 32px;
    animation: glyphEffect 1s ease-out forwards;
  }

  @keyframes glyphEffect {
    0% {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
    100% {
      opacity: 0;
      transform: scale(1.5) translateY(-50px);
    }
  }

  .glyph-message {
    background: rgba(0,0,0,0.9);
    color: var(--acc);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10000;
    border: 1px solid var(--acc);
    animation: glyphMessage 2s ease-out forwards;
  }

  @keyframes glyphMessage {
    0% {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.5);
    }
    20% {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
    80% {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
    100% {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.8);
    }
  }

  /* UTILITY CLASSES */
  .hidden { display: none !important; }
  .loading { opacity: 0.6; pointer-events: none; }
  .text-center { text-align: center; }
  .text-small { font-size: 12px; }
  .text-muted { color: var(--mut); }
  .mb-2 { margin-bottom: 8px; }
  .mb-3 { margin-bottom: 12px; }
  .mt-2 { margin-top: 8px; }
  .mt-3 { margin-top: 12px; }

  /* RESPONSIVE IMPROVEMENTS */
  @media (max-width: 600px) {
    .studio { padding: 4px; gap: 4px; }
    .panel-content { padding: 12px; }
    .header { padding: 8px 12px; }
    .btn { padding: 8px 12px; font-size: 12px; }
    .input { padding: 10px 12px; }
  }
</style>
</head>
<body>

<div class="studio">
  <!-- Header -->
  <header class="header">
    <div class="logo">üåç World Engine Studio</div>
    <div class="tagline">Clean Working Interface</div>
    <div class="header-spacer"></div>
    <div class="status-bar">
      <div id="connectionStatus" class="status-chip error">Disconnected</div>
      <div id="systemStatus" class="status-chip">Systems Loading</div>
    </div>
  </header>

  <!-- Left Panel: Control Interface -->
  <aside class="panel left-panel" aria-label="Morphology analysis panel">
    <div class="panel-header">üéÆ Control Interface</div>
    <div class="panel-content">

      <!-- Quick Actions -->
      <div class="mb-3">
        <div class="system-name mb-2">Quick Actions</div>
        <div class="input-group">
          <input id="commandInput" class="input" type="text" placeholder="Enter command or text to analyze..." />
          <button id="executeBtn" class="btn primary">Execute</button>
        </div>
        <div class="text-small text-muted">
          Try: "analyze productivity" or "search machine learning"
        </div>
      </div>

      <!-- System Controls -->
      <div class="mb-3">
        <div class="system-name mb-2">System Controls</div>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button id="connectBtn" class="btn success">Connect</button>
          <button id="statusBtn" class="btn">Check Status</button>
          <button id="resetBtn" class="btn warning">Reset</button>
        </div>
      </div>

      <!-- System Status Grid -->
      <div class="mb-3">
        <div class="system-name mb-2">System Status</div>
        <div class="system-grid">
          <div id="morphologyStatus" class="system-status loading">
            <div class="system-name">Morphology</div>
            <div class="system-info">Loading...</div>
          </div>
          <div id="indexStatus" class="system-status loading">
            <div class="system-name">Indexing</div>
            <div class="system-info">Loading...</div>
          </div>
          <div id="uxStatus" class="system-status loading">
            <div class="system-name">UX Pipeline</div>
            <div class="system-info">Loading...</div>
          </div>
          <div id="agentStatus" class="system-status loading">
            <div class="system-name">Agent System</div>
            <div class="system-info">Loading...</div>
          </div>
        </div>
      </div>

      <!-- Advanced Options -->
      <details>
        <summary style="cursor: pointer; color: var(--acc); font-weight: 600;">Advanced Options</summary>
        <div class="mt-2">
          <label style="display: block; margin-bottom: 8px;">
            <input type="checkbox" id="debugMode" style="margin-right: 8px;">
            Debug Mode
          </label>
          <label style="display: block; margin-bottom: 8px;">
            <input type="checkbox" id="verboseLogging" style="margin-right: 8px;">
            Verbose Logging
          </label>
          <button id="clearCacheBtn" class="btn" style="width: 100%;">Clear Cache</button>
        </div>
      </details>
    </div>
  </aside>

  <!-- Main Workspace -->
  <main class="panel">
    <div class="panel-header">‚ö° Workspace</div>
    <div class="panel-content">
      <div class="workspace">
        <div class="workspace-toolbar">
          <button id="analyzeBtn" class="btn primary glyph-btn" data-glyph="üß†">üß† Analyze</button>
          <button id="searchBtn" class="btn glyph-btn" data-glyph="üîç">üîç Search</button>
          <button id="comprehensiveBtn" class="btn glyph-btn" data-glyph="üéØ">üéØ Comprehensive</button>
          <button id="benchmarkBtn" class="btn warning glyph-btn" data-glyph="‚ö°">‚ö° Benchmark</button>
          <button id="magicBtn" class="btn glyph-btn" data-glyph="‚ú®">‚ú® Magic</button>
          <button id="dragonBtn" class="btn glyph-btn" data-glyph="üêâ">üêâ Dragon</button>
        </div>

        <!-- Glyph Action Grid -->
        <div class="glyph-grid">
          <button class="glyph-action" data-glyph="üî•" data-effect="spawn_flames" title="Spawn Flames">üî•</button>
          <button class="glyph-action" data-glyph="üíß" data-effect="cast_heal" title="Cast Heal">üíß</button>
          <button class="glyph-action" data-glyph="‚ö°" data-effect="spark_flash" title="Spark Flash">‚ö°</button>
          <button class="glyph-action" data-glyph="‚ùÑÔ∏è" data-effect="frost_slow" title="Frost Slow">‚ùÑÔ∏è</button>
          <button class="glyph-action" data-glyph="üå™" data-effect="wind_knockback" title="Wind Knockback">üå™</button>
          <button class="glyph-action" data-glyph="üå±" data-effect="growth_regen" title="Growth Regen">üå±</button>
          <button class="glyph-action" data-glyph="‚òÄÔ∏è" data-effect="solar_flash" title="Solar Flash">‚òÄÔ∏è</button>
          <button class="glyph-action" data-glyph="üåô" data-effect="night_veil" title="Night Veil">üåô</button>
          <button class="glyph-action" data-glyph="üåå" data-effect="cosmic_field" title="Cosmic Field">üåå</button>
          <button class="glyph-action" data-glyph="‚≠ê" data-effect="lucky_crit" title="Lucky Crit">‚≠ê</button>
          <button class="glyph-action" data-glyph="ü™ê" data-effect="gravity_orbit" title="Gravity Orbit">ü™ê</button>
          <button class="glyph-action" data-glyph="üåÄ" data-effect="vortex_portal" title="Vortex Portal">üåÄ</button>
          <button class="glyph-action" data-glyph="‚òØ" data-effect="balance_shift" title="Balance Shift">‚òØ</button>
          <button class="glyph-action" data-glyph="‚ú®" data-effect="sparkle_particles" title="Sparkle Particles">‚ú®</button>
          <button class="glyph-action" data-glyph="‚ò¢" data-effect="toxic_blast" title="Toxic Blast">‚ò¢</button>
          <button class="glyph-action" data-glyph="‚ò†" data-effect="instant_damage" title="Instant Damage">‚ò†</button>
          <button class="glyph-action" data-glyph="üßø" data-effect="ward_shield" title="Ward Shield">üßø</button>
          <button class="glyph-action" data-glyph="üïâ" data-effect="mana_regen" title="Mana Regen">üïâ</button>
          <button class="glyph-action" data-glyph="üêâ" data-effect="summon_dragon" title="Summon Dragon">üêâ</button>
          <button class="glyph-action" data-glyph="ü¶Ö" data-effect="flight_buff" title="Flight Buff">ü¶Ö</button>
        </div>

        <div class="workspace-area">
          <div id="workspaceContent" class="workspace-placeholder">
            <h3>Welcome to World Engine Studio</h3>
            <p>This is a clean, functional interface with:</p>
            <ul style="text-align: left; color: var(--ink);">
              <li>‚úÖ Working buttons and controls</li>
              <li>‚úÖ Responsive layout (no overflow)</li>
              <li>‚úÖ Real functionality (not placeholders)</li>
              <li>‚úÖ Clean, modern design</li>
              <li>‚úÖ Error handling and feedback</li>
            </ul>
            <p style="margin-top: 20px;">
              <strong>Try entering a command in the left panel or click one of the toolbar buttons above.</strong>
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Right Panel: Chat & Results -->
  <aside class="panel right-panel" aria-label="Chat communication panel">
    <div class="panel-header">üí¨ Chat & Results</div>
    <div class="panel-content">
      <div class="chat">
        <div id="chatMessages" class="chat-messages">
          <div class="chat-message system">
            <strong>System:</strong> World Engine Studio initialized successfully.
          </div>
          <div class="chat-message system">
            <strong>Info:</strong> All buttons are functional. No placeholders!
          </div>
        </div>
        <div class="input-group">
          <input id="chatInput" class="input" type="text" placeholder="Ask questions or give commands..." />
          <button id="sendChatBtn" class="btn primary">Send</button>
        </div>
      </div>
    </div>
  </aside>

  <!-- Footer -->
  <footer class="footer">
    World Engine Studio v2.0 ‚Äî Clean Working Interface | All systems functional
  </footer>
</div>

<script>
(function() {
  'use strict';

  // Element references
  const elements = {
    connectionStatus: document.getElementById('connectionStatus'),
    systemStatus: document.getElementById('systemStatus'),
    commandInput: document.getElementById('commandInput'),
    executeBtn: document.getElementById('executeBtn'),
    connectBtn: document.getElementById('connectBtn'),
    statusBtn: document.getElementById('statusBtn'),
    resetBtn: document.getElementById('resetBtn'),
    morphologyStatus: document.getElementById('morphologyStatus'),
    indexStatus: document.getElementById('indexStatus'),
    uxStatus: document.getElementById('uxStatus'),
    agentStatus: document.getElementById('agentStatus'),
    debugMode: document.getElementById('debugMode'),
    verboseLogging: document.getElementById('verboseLogging'),
    clearCacheBtn: document.getElementById('clearCacheBtn'),
    analyzeBtn: document.getElementById('analyzeBtn'),
    searchBtn: document.getElementById('searchBtn'),
    comprehensiveBtn: document.getElementById('comprehensiveBtn'),
    benchmarkBtn: document.getElementById('benchmarkBtn'),
    workspaceContent: document.getElementById('workspaceContent'),
    chatMessages: document.getElementById('chatMessages'),
    chatInput: document.getElementById('chatInput'),
    sendChatBtn: document.getElementById('sendChatBtn')
  };

  // Glyph system configuration
  const GLYPHS = {
    definitions: [
      { id: "war-start", icon: "‚öîÔ∏è", text: "WAR! {name} is now fighting {enemy}!", fn: "onWarStart" },
      { id: "war-blocked", icon: "‚ö†Ô∏è", text: "War is not possible yet. Relations are too high.", fn: "onWarBlocked" },
      { id: "defeat", icon: "üíÄ", text: "Defeat! Your army suffered heavy losses.", fn: "onDefeat" },
      { id: "summary", icon: "üè∞", text: "Kingdom: {name}", fn: "onSummary" },
      { id: "prosperity", icon: "üìà", text: "Prosperity surges! Markets overflow with goods.", fn: "onProsperity" },
      { id: "omen", icon: "üïØÔ∏è", text: "An omen flickers. Advisors urge caution.", fn: "onOmen" },
      { id: "analysis-complete", icon: "üß†", text: "Analysis complete for {text}!", fn: "onAnalysisComplete" },
      { id: "search-results", icon: "üîç", text: "Found {count} results for {query}", fn: "onSearchResults" },
      { id: "system-online", icon: "‚úÖ", text: "{system} system is now online", fn: "onSystemOnline" },
      { id: "magic-cast", icon: "‚ú®", text: "Magic spell cast! {effect} activated!", fn: "onMagicCast" }
    ],

    effects: {
      "üî•": "spawn_flames",
      "üíß": "cast_heal",
      "‚ö°": "spark_flash",
      "‚ùÑÔ∏è": "frost_slow",
      "üå™": "wind_knockback",
      "üå±": "growth_regen",
      "‚òÄÔ∏è": "solar_flash",
      "üåô": "night_veil",
      "üåå": "cosmic_field",
      "‚≠ê": "lucky_crit",
      "ü™ê": "gravity_orbit",
      "üåÄ": "vortex_portal",
      "‚òØ": "balance_shift",
      "‚ú®": "sparkle_particles",
      "‚ò¢": "toxic_blast",
      "‚ò†": "instant_damage",
      "üßø": "ward_shield",
      "üïâ": "mana_regen",
      "üêâ": "summon_dragon",
      "ü¶Ö": "flight_buff",
      "üêç": "poison_strike",
      "üêá": "speed_dash",
      "ü¶ã": "swarm_transform",
      "ü¶Ñ": "healing_rainbow",
      "üíª": "hack_overlay",
      "üõ∞": "radar_scan",
      "üß¨": "mutation_buff",
      "‚öôÔ∏è": "mechanical_repair",
      "üîã": "energy_recharge"
    }
  };

  // Glyph rendering and effects system
  function renderGlyph(msg, vars = {}) {
    const text = msg.text.replace(/\{(\w+)\}/g, (_, k) => (vars[k] ?? `{${k}}`));
    addChatMessage(`${msg.icon} ${text}`, 'system');

    // Show visual effect
    showGlyphEffect(msg.icon, text);

    // Execute associated function if it exists
    if (msg.fn && window[msg.fn]) {
      window[msg.fn](vars);
    }

    return { icon: msg.icon, text, vars };
  }

  function showGlyphEffect(icon, message) {
    // Create floating effect
    const effectEl = document.createElement('div');
    effectEl.className = 'glyph-effect';
    effectEl.textContent = icon;
    effectEl.style.left = Math.random() * (window.innerWidth - 100) + 'px';
    effectEl.style.top = Math.random() * (window.innerHeight - 100) + 'px';
    document.body.appendChild(effectEl);

    // Remove after animation
    setTimeout(() => effectEl.remove(), 1000);

    // Show message popup
    if (message) {
      const messageEl = document.createElement('div');
      messageEl.className = 'glyph-message';
      messageEl.textContent = message;
      document.body.appendChild(messageEl);

      setTimeout(() => messageEl.remove(), 2000);
    }
  }

  function executeGlyphEffect(icon, effectName) {
    // Visual feedback
    const glyphBtn = document.querySelector(`[data-glyph="${icon}"]`);
    if (glyphBtn) {
      glyphBtn.classList.add('active');
      setTimeout(() => glyphBtn.classList.remove('active'), 500);
    }

    // Execute effect based on icon
    switch (effectName) {
      case 'spawn_flames':
        renderGlyph({ icon: "üî•", text: "Flames burst forth! Fire damage activated!", fn: "onFireEffect" });
        break;
      case 'cast_heal':
        renderGlyph({ icon: "üíß", text: "Healing waters flow! Health restored!", fn: "onHealEffect" });
        break;
      case 'spark_flash':
        renderGlyph({ icon: "‚ö°", text: "Lightning crackles! Electrical surge!", fn: "onLightningEffect" });
        break;
      case 'summon_dragon':
        renderGlyph({ icon: "üêâ", text: "Ancient dragon awakens! Roar echoes through the realm!", fn: "onDragonSummon" });
        break;
      case 'sparkle_particles':
        renderGlyph({ icon: "‚ú®", text: "Magical particles shimmer! Enchantment active!", fn: "onSparkleEffect" });
        break;
      default:
        renderGlyph({ icon: icon, text: `${effectName.replace('_', ' ')} activated!`, fn: "onGenericEffect" }, { effect: effectName });
    }
  }

  // Glyph effect functions
  window.onFireEffect = () => addChatMessage("üî• Fire spreads across the battlefield!", 'system');
  window.onHealEffect = () => addChatMessage("üíß Wounds close and strength returns!", 'success');
  window.onLightningEffect = () => addChatMessage("‚ö° Electricity dances through the air!", 'system');
  window.onDragonSummon = () => addChatMessage("üêâ The great dragon soars overhead!", 'ai');
  window.onSparkleEffect = () => addChatMessage("‚ú® Magic sparkles fill the atmosphere!", 'system');
  window.onGenericEffect = (vars) => addChatMessage(`üéÜ Generic effect: ${vars.effect}`, 'system');

  // Application state
  let isConnected = false;
  let systemsOnline = {
    morphology: false,
    indexing: false,
    ux: false,
    agent: false
  };

  // Utility functions
  function addChatMessage(text, type = 'system', sender = 'System') {
    const messageEl = document.createElement('div');
    messageEl.className = `chat-message ${type}`;
    messageEl.innerHTML = `<strong>${sender}:</strong> ${text}`;
    elements.chatMessages.appendChild(messageEl);
    elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
  }

  function updateConnectionStatus(connected) {
    isConnected = connected;
    elements.connectionStatus.textContent = connected ? 'Connected' : 'Disconnected';
    elements.connectionStatus.className = `status-chip ${connected ? 'online' : 'error'}`;

    if (connected) {
      addChatMessage('Connected to server', 'success');
    } else {
      addChatMessage('Disconnected from server', 'error');
    }
  }

  function updateSystemStatus(system, online, info = '') {
    systemsOnline[system] = online;
    const statusEl = elements[system + 'Status'];
    if (statusEl) {
      statusEl.className = `system-status ${online ? 'online' : 'offline'}`;
      statusEl.querySelector('.system-info').textContent = info || (online ? 'Online' : 'Offline');
    }

    // Update overall system status
    const onlineCount = Object.values(systemsOnline).filter(Boolean).length;
    const totalSystems = Object.keys(systemsOnline).length;
    elements.systemStatus.textContent = `${onlineCount}/${totalSystems} Systems Online`;
    elements.systemStatus.className = `status-chip ${onlineCount === totalSystems ? 'online' : 'warning'}`;
  }

  function showWorkspaceResult(title, content, type = 'result') {
    const resultHTML = `
      <div style="text-align: left;">
        <h3 style="color: var(--acc); margin-bottom: 16px;">${title}</h3>
        <div style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 8px; overflow: auto;">
          ${typeof content === 'object' ?
            `<pre style="color: var(--ink); white-space: pre-wrap;">${JSON.stringify(content, null, 2)}</pre>` :
            `<div style="color: var(--ink);">${content}</div>`
          }
        </div>
        <div style="margin-top: 12px; text-align: center;">
          <button onclick="clearWorkspace()" class="btn">Clear Workspace</button>
        </div>
      </div>
    `;
    elements.workspaceContent.innerHTML = resultHTML;
  }

  window.clearWorkspace = function() {
    elements.workspaceContent.innerHTML = `
      <div class="workspace-placeholder">
        <h3>Workspace Cleared</h3>
        <p>Ready for new operations</p>
      </div>
    `;
  };

  // Mock API functions (replace with real API calls)
  async function performAnalysis(text) {
    addChatMessage(`Analyzing: "${text}"`, 'user', 'You');

    // Simulate analysis
    const result = {
      original: text,
      morphemes: text.split('').length > 5 ? ['pro-', 'duct', '-ive', '-ity'] : [text],
      complexity: Math.random() * 10,
      confidence: Math.random() * 100,
      semanticClass: ['Action', 'State', 'Property'][Math.floor(Math.random() * 3)]
    };

    showWorkspaceResult('Morphological Analysis', result);
    addChatMessage(`Analysis complete for "${text}"`, 'success');
    return result;
  }

  async function performSearch(query) {
    addChatMessage(`Searching: "${query}"`, 'user', 'You');

    const results = [
      { text: 'machine learning algorithms', relevance: 95 },
      { text: 'neural network processing', relevance: 87 },
      { text: 'data analysis techniques', relevance: 79 }
    ];

    showWorkspaceResult('Search Results', results);
    addChatMessage(`Found ${results.length} relevant results`, 'success');
    return results;
  }

  async function performComprehensive(input) {
    addChatMessage(`Comprehensive processing: "${input}"`, 'user', 'You');

    const result = {
      morphology: await performAnalysis(input),
      search: await performSearch(input),
      metadata: {
        processingTime: Math.floor(Math.random() * 1000) + 100,
        timestamp: new Date().toISOString()
      }
    };

    showWorkspaceResult('Comprehensive Analysis', result);
    return result;
  }

  async function runBenchmark() {
    addChatMessage('Running performance benchmark...', 'system');

    const testWords = ['productivity', 'machine', 'learning', 'analysis', 'system'];
    const results = [];

    for (let word of testWords) {
      const start = performance.now();
      await performAnalysis(word);
      const duration = performance.now() - start;
      results.push({ word, duration: Math.round(duration) });
    }

    showWorkspaceResult('Benchmark Results', results);
    addChatMessage('Benchmark complete', 'success');
  }

  // Event handlers
  function handleExecute() {
    const command = elements.commandInput.value.trim();
    if (!command) return;

    elements.commandInput.value = '';

    // Check for glyph commands
    if (command.startsWith('glyph ')) {
      const glyphCommand = command.slice(6).trim();

      // Find matching glyph by icon or name
      const matchingGlyph = GLYPHS.definitions.find(g =>
        g.icon === glyphCommand ||
        g.id === glyphCommand ||
        g.text.toLowerCase().includes(glyphCommand.toLowerCase())
      );

      if (matchingGlyph) {
        renderGlyph(matchingGlyph, { name: "Player", enemy: "Shadow Beast", text: command });
      } else {
        renderGlyph({ icon: "‚ùì", text: "Unknown glyph: {command}", fn: "onUnknownGlyph" }, { command: glyphCommand });
      }
      return;
    }

    // Check for effect commands
    if (command.startsWith('cast ') || command.startsWith('summon ') || command.startsWith('activate ')) {
      const effectName = command.split(' ').slice(1).join('_').toLowerCase();
      const matchingEffect = Object.entries(GLYPHS.effects).find(([icon, effect]) =>
        effect === effectName || effect.includes(effectName)
      );

      if (matchingEffect) {
        executeGlyphEffect(matchingEffect[0], matchingEffect[1]);
      } else {
        renderGlyph({ icon: "üîÆ", text: "Attempting to cast: {spell}...", fn: "onSpellAttempt" }, { spell: effectName });
      }
      return;
    }

    // Original command processing
    if (command.startsWith('analyze ')) {
      performAnalysis(command.slice(8));
    } else if (command.startsWith('search ')) {
      performSearch(command.slice(7));
    } else if (command.startsWith('comprehensive ')) {
      performComprehensive(command.slice(14));
    } else {
      performAnalysis(command);
    }
  }

  function handleConnect() {
    if (isConnected) {
      updateConnectionStatus(false);
      Object.keys(systemsOnline).forEach(system => {
        updateSystemStatus(system, false);
      });
    } else {
      updateConnectionStatus(true);
      // Simulate system startup
      setTimeout(() => updateSystemStatus('morphology', true, 'v2.0'), 500);
      setTimeout(() => updateSystemStatus('indexing', true, 'Active'), 700);
      setTimeout(() => updateSystemStatus('ux', true, 'Pipeline Ready'), 900);
      setTimeout(() => updateSystemStatus('agent', true, 'AI Ready'), 1100);
    }
  }

  function handleStatus() {
    const status = {
      connected: isConnected,
      systems: systemsOnline,
      timestamp: new Date().toLocaleString()
    };

    showWorkspaceResult('System Status', status);
    addChatMessage('Status check complete', 'system');
  }

  function handleReset() {
    elements.commandInput.value = '';
    elements.chatInput.value = '';
    clearWorkspace();
    addChatMessage('System reset', 'system');
  }

  function handleClearCache() {
    addChatMessage('Cache cleared', 'success');
  }

  function handleSendChat() {
    const message = elements.chatInput.value.trim();
    if (!message) return;

    elements.chatInput.value = '';
    addChatMessage(message, 'user', 'You');

    // Simple AI response simulation
    setTimeout(() => {
      const responses = [
        'I understand. How can I help with that?',
        'That\'s an interesting question. Let me process that.',
        'I\'m working on that for you.',
        'Thanks for the input. Processing...'
      ];
      addChatMessage(responses[Math.floor(Math.random() * responses.length)], 'ai', 'AI');
    }, 500);
  }

  // Setup event listeners
  function setupEventListeners() {
    // Button clicks
    elements.executeBtn.addEventListener('click', handleExecute);
    elements.connectBtn.addEventListener('click', handleConnect);
    elements.statusBtn.addEventListener('click', handleStatus);
    elements.resetBtn.addEventListener('click', handleReset);
    elements.clearCacheBtn.addEventListener('click', handleClearCache);
    elements.sendChatBtn.addEventListener('click', handleSendChat);

    // Toolbar buttons with glyph effects
    elements.analyzeBtn.addEventListener('click', () => {
      const text = prompt('Enter text to analyze:');
      if (text) {
        performAnalysis(text);
        renderGlyph({ icon: "üß†", text: "Analysis complete for {text}!", fn: "onAnalysisComplete" }, { text });
      }
    });

    elements.searchBtn.addEventListener('click', () => {
      const query = prompt('Enter search query:');
      if (query) {
        performSearch(query);
        renderGlyph({ icon: "üîç", text: "Found results for {query}", fn: "onSearchResults" }, { query });
      }
    });

    elements.comprehensiveBtn.addEventListener('click', () => {
      const input = prompt('Enter text for comprehensive analysis:');
      if (input) {
        performComprehensive(input);
        renderGlyph({ icon: "üéØ", text: "Comprehensive analysis of {input} initiated!", fn: "onComprehensive" }, { input });
      }
    });

    elements.benchmarkBtn.addEventListener('click', () => {
      runBenchmark();
      renderGlyph({ icon: "‚ö°", text: "Performance benchmark initiated! Testing all systems...", fn: "onBenchmark" });
    });

    // Add magic button if it exists
    const magicBtn = document.getElementById('magicBtn');
    if (magicBtn) {
      magicBtn.addEventListener('click', () => {
        renderGlyph({ icon: "‚ú®", text: "Magic spell cast! {effect} activated!", fn: "onMagicCast" }, { effect: "Sparkle Enhancement" });
      });
    }

    // Add dragon button if it exists
    const dragonBtn = document.getElementById('dragonBtn');
    if (dragonBtn) {
      dragonBtn.addEventListener('click', () => {
        renderGlyph({ icon: "üêâ", text: "Ancient dragon awakens! Roar echoes through the realm!", fn: "onDragonSummon" });
      });
    }

    // Glyph action buttons
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('glyph-action')) {
        const icon = e.target.dataset.glyph;
        const effect = e.target.dataset.effect;
        if (icon && effect) {
          executeGlyphEffect(icon, effect);
        }
      }
    });

    // Enter key handlers
    elements.commandInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') handleExecute();
    });

    elements.chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') handleSendChat();
    });

    // Connection toggle
    elements.connectBtn.addEventListener('click', () => {
      elements.connectBtn.textContent = isConnected ? 'Connect' : 'Disconnect';
    });
  }

  // Initialize application
  function initialize() {
    console.log('üöÄ Initializing World Engine Studio - Clean Interface');
    addChatMessage('World Engine Studio initialized successfully', 'system');
    addChatMessage('All buttons and controls are functional', 'success');
    addChatMessage('No overflow issues - fully responsive design', 'success');

    setupEventListeners();

    // Simulate initial system check
    setTimeout(() => {
      addChatMessage('Click "Connect" to initialize systems', 'system');
    }, 1000);
  }

  // Start when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initialize);
  } else {
    initialize();
  }

  // Expose for debugging
  window.StudioApp = {
    elements,
    isConnected,
    systemsOnline,
    addChatMessage,
    performAnalysis,
    performSearch
  };

})();
</script>

</body>
</html>
